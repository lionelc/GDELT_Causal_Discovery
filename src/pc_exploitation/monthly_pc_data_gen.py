import sys
from os import listdir

def main():
    type = int(sys.argv[1])
    start_year = int(sys.argv[2])
    end_year = int(sys.argv[3])
    
    target = sys.argv[4]
    players = [elem for elem in sys.argv[5].split(",")]

    monnum = (end_year-start_year+1)*12

    d = dict()
    for elem in players:
	d[elem] = [0]*monnum

    for year in range(start_year, end_year+1):
        files = listdir("tsdata/"+str(year)+"/")
	for file in files:
	    ent = file.split(".")[0].split("-")
	    if type == 0 and (ent[0] != target or not ent[1] in players):
		continue
	    elif type == 1 and (ent[1] != target or not ent[0] in players):
		continue

	    if ent[0] == ent[1]:
		continue

	    fn = "tsdata/"+str(year)+"/"+file
	    print fn
	    f = open(fn)
	    line = f.readline()
	    while line != None and len(line) > 1:
		sp = line.strip().split(",")
		cc = int(sp[1])
		ds = sp[0].split("-")
		mm = 12*(int(ds[0])-start_year)+int(ds[1])-1
		if type == 0:
		    d[ent[1]][mm] += cc
		else:
		    d[ent[0]][mm] += cc
  
		line = f.readline()

	    f.close()

    print "write begins..."
    fw = open(sys.argv[6], "w")
    fw.write(sys.argv[5]+"\n")

    for i in xrange(monnum):
	for j in xrange(len(players)):
	    #fw.write(str(i+1)+",")
	    fw.write(str(d[players[j]][i]))
	    if j < len(players)-1:
		fw.write(",")
	    else:
		fw.write("\n")
    fw.close()
    

if __name__ == "__main__":
    main()
