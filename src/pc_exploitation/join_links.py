import sys
from os import listdir

def match(s1, s2):
    sp1 = s1.split("-")
    sp2 = s2.split("-")

    try:
	if sp1[0] == sp2[1] and sp1[1] == sp2[0]:
	    return True
    except:
	return False

    return False

def switch(s1):
    sp = s1.split("-")
    return sp[1]+"-"+sp[0]

def main():    
    files = listdir("exploitation_data/")
    d = dict()
    s = dict()
    dc = dict()
    allnum = 0

    for file in files:
	pref = file[:5]
	tar = file[:3]

	f = open("exploitation_data/"+file)
	line = f.readline()
	ctry = line.strip().split(",")
	f.close()

	curs = set()

	pcf = open("exploitation_pc/"+pref)
	line = pcf.readline()
	linenum = 0
	while line != None and len(line) > 1:
	    sp = line.strip().split()
	    for i in xrange(len(sp)):
		if sp[i] == "1":
		    curs.add(ctry[linenum]+"-"+ctry[i])
	    line = pcf.readline()
	    linenum += 1
	  
	pcf.close()

	if not tar in d:
	    d[tar] = curs
	    allnum += len(curs)
	else:
	    alts = set()
	    for elem in curs:
		alts.add(switch(elem))
	    allnum += len(curs)
	    for elem in d[tar]:
		if not elem in alts:
		    if not elem in s:
			s[elem] = set()
		    if pref[-1] == "0": 
		        s[elem].add("-"+tar)
		    else:
			s[elem].add("+"+tar)
		else:
		    #subsp = elem.split("-")
		    #if subsp[0] > subsp[1]:
		    #	elem = switch(elem)
		    if not elem in dc:
			dc[elem] = set()
		    dc[elem].add(tar)

	    for elem in alts:
		if not elem in d[tar]:
		    elem = switch(elem)
		    if not elem in s:
                        s[elem] = set()
		    if pref[-1] == "0":
			s[elem].add("+"+tar)
		    else:
			s[elem].add("-"+tar)

    #print allnum
    #print len(s)
    #print len(dc)

    revd = dict()
    subsum = 0
    uninum = 0
    depnum = 0 
    dcar = []
    for elem in dc:
	dcar.append([elem, dc[elem]])
	if len(dc[elem]) < 2:
	    subsum += 1
	    if "usa" in elem or "chn" in elem or "rus" in elem:
		uninum+=1
	    
	    for subelem in dc[elem]:
		    if "usa" in subelem or "chn" in subelem or "rus" in subelem:
		        depnum += 1
		        break
	if not len(dc[elem]) in revd:
	    revd[len(dc[elem])] = 0
	revd[len(dc[elem])] += 1

    dcar = sorted(dcar, key=lambda x:x[0])
    #print subsum
    #for elem in dc:
    #	sp = elem.split("-")
    #    for subelem in dc[elem]:
    #	    print sp[0]+"-"+subelem
    #	    print sp[1]+"-"+subelem
    
    for elem in dcar:
        print elem    
 
    print revd
    #print uninum
    #print depnum

if __name__ == "__main__":
    main()
